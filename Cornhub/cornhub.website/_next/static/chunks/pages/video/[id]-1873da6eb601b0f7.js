(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[582],{44614:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/video/[id]",function(){return n(71970)}])},71970:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return A}});var i,s=n(11010),r=n(91309),o=n(70655),a=n(85893);n(4854),n(62722);var c=n(67294),l=n(99642),u=n(9473),d=n(71926),m=n(21733),h=n(52327),f=n(18403),v=n(69670),p=n(11163),x=n(9008),g=n.n(x),j=n(41664),b=n.n(j),N=n(5152),w=n.n(N),y=n(74402),_=n(47041),k=n(25795),C=n(1569),Z=n(11762),S=n(7108),P=n(5853),F=w()(function(){return Promise.all([n.e(412),n.e(90),n.e(929),n.e(469)]).then(n.bind(n,27469))},{loadableGenerated:{webpack:function(){return[27469]}},ssr:!1});function A(e){var t,n=e.video,i=e.error,f=(0,u.v9)(function(e){return e.user}),v=(0,p.useRouter)(),x=(0,u.I0)(),j=v.query.id,N=(0,r._)((0,c.useState)([]),2),w=N[0],y=N[1],Z=(0,r._)((0,c.useState)(null==n?void 0:n.my_rating),2),S=Z[0],A=Z[1],J=(0,c.useRef)({data:[],lastSec:0,secs:0});function B(e){return L.apply(this,arguments)}function L(){return(L=(0,s._)(function(e){var t,n;return(0,o.Jh)(this,function(i){switch(i.label){case 0:if(void 0===f)return[2];if(null===f)return v.push("/login"),[2];if(A(n=S===(t=e?1:0)?null:t),null!==n)return[3,2];return[4,l.ZP.delete("/video/".concat(j,"/rating"))];case 1:return i.sent(),[3,4];case 2:return[4,l.ZP.put("/video/".concat(j,"/rating"),{rating:n})];case 3:i.sent(),i.label=4;case 4:return[2]}})})).apply(this,arguments)}if((0,c.useEffect)(function(){x({type:"navbar:setActiveCategory",val:"videos"});for(var e=[],t=0;t<Math.ceil(n.length/1e3);t++)e[t]=0;J.current.data=e;var i=function(){if(0!==J.current.data.length&&0!==J.current.data.filter(function(e){return 0!==e}).length){var e={data:J.current.data,viewtime:J.current.secs},t=(0,_.getCookie)("authentication");fetch("".concat((0,l.DZ)(),"/video/").concat(j,"/engagement"),{method:"POST",keepalive:!0,headers:{Authorization:t?"Bearer ".concat(t):void 0,"Content-Type":"application/json"},body:JSON.stringify(e)})}};function r(){return(r=(0,s._)(function(){return(0,o.Jh)(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,l.ZP.get("/video/".concat(j,"/engagement"))];case 1:return y(e.sent().data.map(function(e){return{data:e}})),[3,3];case 2:return e.sent(),[3,3];case 3:return[2]}})})).apply(this,arguments)}function a(){return(a=(0,s._)(function(){return(0,o.Jh)(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,l.ZP.post("/video/".concat(j,"/viewed"))];case 1:case 2:return e.sent(),[3,3];case 3:return[2]}})})).apply(this,arguments)}return function(){r.apply(this,arguments)}(),function(){a.apply(this,arguments)}(),window.addEventListener("beforeunload",i),function(){window.removeEventListener("beforeunload",i),i()}},[j,x]),i)return(0,a.jsx)(k.Z,{error:i});var I=n.my_rating,T=I===S?0:D(I)?1===S?1:0:1===I?-1:D(S)?0:1,X=I===S?0:D(I)?0===S?1:0:0===I?-1:D(S)?0:1,z=50;if(n.likes+T>0||n.dislikes+X>0){var R=n.likes+T+n.dislikes+X;z=Math.round((n.likes+T)/R*100)}return(0,a.jsxs)("div",{className:"p-3 max-w-1300px m-auto",children:[(0,a.jsxs)(g(),{children:[(0,a.jsx)("title",{children:"".concat(n.title," - CornHub")}),(0,a.jsx)("meta",{property:"og:title",content:"".concat(n.title," - CornHub")}),(0,a.jsx)("meta",{property:"og:image",content:(0,C.AJ)(n)}),(0,a.jsx)("meta",{property:"og:type",content:"video"}),(0,a.jsx)("meta",{property:"og:video",content:"https://cornhub.objectdepot.net/video/".concat(n.link_id,"/").concat((0,C.WX)(n)[0],".mp4")})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-10",children:[(0,a.jsxs)("div",{className:"md:col-span-7",children:[(0,a.jsx)("div",{className:"w-full",children:(0,a.jsx)(F,{video:n,engagement:J,videoEngagement:w},n.id)}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d.Z,{orientation:"horizontal",page:"video",position:"below-video",context:n.id}),(0,a.jsx)("h1",{className:"text-2xl font-bold",children:n.title}),(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsxs)("h3",{className:"w-full text-sm text-slate-400",children:[(0,a.jsx)(P.N,{id:1!==n.views?"video.view_count.plural":"video.view_count.single",placeholders:{count:(0,m.CZ)(n.views)}}),"\xa0|\xa0",(0,a.jsx)("img",{src:"https://cornhub.objectdepot.net/static/icons/like.svg",width:12,height:12,className:"inline ml-1",alt:"Likes"})," ",z,"% \xa0|\xa0",(0,m.BK)(new Date(n.created_at))]}),(0,a.jsxs)("div",{className:"grid items-right grid-flow-col auto-cols-auto w-max text-slate-400 gap-5 mr-1",children:[(0,a.jsxs)("button",{className:"w-max",onClick:function(){return B(!0)},children:[(0,a.jsx)("img",{src:1!==S?"https://cornhub.objectdepot.net/static/icons/like.svg":"https://cornhub.objectdepot.net/static/icons/liked.svg",width:16,height:16,className:"inline ml-1 mr-2",alt:"Like"})," ",(0,m.CZ)(n.likes+T)]}),(0,a.jsxs)("button",{className:"w-max",onClick:function(){return B(!1)},children:[(0,a.jsx)("img",{src:0!==S?"https://cornhub.objectdepot.net/static/icons/dislike.svg":"https://cornhub.objectdepot.net/static/icons/disliked.svg",width:16,height:16,className:"inline ml-1 mr-2",alt:"Dislike"})," ",(0,m.CZ)(n.dislikes+X)]})]})]}),(0,a.jsx)("hr",{className:"mt-2 mb-2 border-gray-700"}),(0,a.jsx)("div",{children:(0,a.jsxs)(b(),{href:"/model/".concat(n.uploader.username),className:"flex",children:[(0,a.jsx)("img",{src:(0,h.SX)(n.uploader),alt:"Avatar",width:64,height:64,className:"rounded-full"}),(0,a.jsxs)("div",{className:"ml-3 inline-block m-auto",children:[(0,a.jsxs)("h2",{className:"text-xl",children:[null!==(t=n.uploader.display_name)&&void 0!==t?t:n.uploader.username," ",(0,a.jsx)(h.sC,{user:n.uploader,className:"inline"})]}),(0,a.jsx)("h3",{className:"text-slate-400",children:(0,a.jsx)(P.N,{id:1!==n.uploader.video_count?"model.video_count.plural":"model.video_count.single",placeholders:{count:(0,m.CZ)(n.uploader.video_count)}})})]})]})}),(0,a.jsx)("hr",{className:"mt-2 mb-2 border-gray-700"}),(0,a.jsx)(E,{videoId:n.id})]})]}),(0,a.jsxs)("div",{className:"md:col-span-3",children:[(0,a.jsxs)("div",{className:"grid sm:grid-cols-2 ml-auto mr-auto md:block w-max",children:[(0,a.jsx)(d.Z,{orientation:"square",page:"video",position:"besides-video",context:n.id}),(0,a.jsx)(d.Z,{orientation:"square",page:"video",position:"besides-video",context:n.id})]}),(0,a.jsxs)("div",{className:"ml-2",children:[(0,a.jsx)("h3",{className:"text-lg font-bold",children:(0,a.jsx)(P.N,{id:"video.recommended"})}),(0,a.jsx)(q,{video:n})]})]})]})]})}function E(e){var t=e.videoId,n=(0,r._)((0,c.useState)(),2),i=n[0],u=n[1],d=(0,r._)((0,c.useState)(void 0),2),m=d[0],h=d[1],f=(0,r._)((0,c.useState)(0),2),v=f[0],p=f[1],x=function(){return p(v+1)};if((0,c.useEffect)(function(){function e(){return(e=(0,s._)(function(){var e,n;return(0,o.Jh)(this,function(i){switch(i.label){case 0:return[4,l.ZP.get("/video/".concat(t,"/comments"))];case 1:return(e=i.sent().data).sort(S.sortComments),n=function(e){e.sort(S.sortComments),e.forEach(function(e){return n(e.children)})},e.forEach(function(e){return n(e.children)}),u(e),h(void 0),[2]}})})).apply(this,arguments)}!function(){e.apply(this,arguments)}()},[t,v]),!i)return(0,a.jsx)(y.Z,{});var g=function(e,t){return e+t.children.reduce(g,t.children.length)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("h2",{className:"text-xl",children:(0,a.jsx)(P.N,{id:"video.comments",placeholders:{count:i.reduce(g,i.length)}})}),(0,a.jsx)(B,{videoId:t,refresh:x}),(0,a.jsx)("div",{children:i.map(function(e){return(0,a.jsx)(J,{comment:e,commentBoxShownFor:m,refresh:x,setCommentBoxShownFor:h},e.id)})})]})}function J(e){var t,n=e.comment,i=e.depth,d=void 0===i?0:i,f=e.commentBoxShownFor,v=e.setCommentBoxShownFor,x=e.refresh,g=(0,r._)((0,c.useState)(n.my_rating),2),j=g[0],N=g[1],w=(0,u.v9)(function(e){return e.user}),y=(0,p.useRouter)();function _(e){return k.apply(this,arguments)}function k(){return(k=(0,s._)(function(e){var t,i;return(0,o.Jh)(this,function(s){switch(s.label){case 0:if(void 0===w)return[2];if(null===w)return y.push("/login"),[2];if(N(i=j===(t=e?1:0)?null:t),null!==i)return[3,2];return[4,l.ZP.delete("/video/".concat(n.video_id,"/comment/").concat(n.id,"/rating"))];case 1:return s.sent(),[3,4];case 2:return[4,l.ZP.put("/video/".concat(n.video_id,"/comment/").concat(n.id,"/rating"),{rating:i})];case 3:s.sent(),s.label=4;case 4:return[2]}})})).apply(this,arguments)}function C(){return(C=(0,s._)(function(){return(0,o.Jh)(this,function(e){switch(e.label){case 0:return[4,l.ZP.delete("/video/".concat(n.video_id,"/comment/").concat(n.id))];case 1:return e.sent(),x(),[2]}})})).apply(this,arguments)}function S(){return(S=(0,s._)(function(){return(0,o.Jh)(this,function(e){switch(e.label){case 0:return[4,l.ZP.post("/video/".concat(n.video_id,"/comment/").concat(n.id,"/restore"))];case 1:return e.sent(),x(),[2]}})})).apply(this,arguments)}var F=n.my_rating,A=F===j?0:D(F)?1===j?1:0:1===F?-1:D(j)?0:1,E=F===j?0:D(F)?0===j?1:0:0===F?-1:D(j)?0:1;return(0,a.jsxs)("div",{className:"".concat(0!==d&&d<=5?"ml-8 pl-2":"pl-0"),children:[(0,a.jsxs)("div",{className:"".concat((n.flags&Z.CommentFlags.Deleted)!=0?"bg-red-500 bg-opacity-20":""," p-2"),children:[(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("img",{src:(0,h.SX)(n.commenter),width:32,height:32,alt:"Avatar",className:"rounded-full h-max"}),(0,a.jsxs)(b(),{className:"ml-1 text-primary m-auto text-lg font-semibold overflow-auto",href:"/model/".concat(n.commenter.username),children:[null!==(t=n.commenter.display_name)&&void 0!==t?t:n.commenter.username,(0,a.jsx)(h.sC,{user:n.commenter,className:"inline ml-1"}),(0,a.jsx)("span",{className:"text-slate-400 text-xs font-normal ml-1",children:(0,m.BK)(n.created_at)})]})]}),(0,a.jsx)("p",{className:"break-all overflow-auto",children:n.comment}),(0,a.jsx)("div",{children:n.id?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("button",{onClick:function(){return _(!0)},children:[(0,a.jsx)("img",{src:1!==j?"https://cornhub.objectdepot.net/static/icons/like.svg":"https://cornhub.objectdepot.net/static/icons/liked.svg",width:16,height:16,className:"inline ml-1 mr-1",alt:"Like"})," ",(0,m.CZ)(n.likes+A)]}),(0,a.jsxs)("button",{className:"ml-2 mr-2",onClick:function(){return _(!1)},children:[(0,a.jsx)("img",{src:0!==j?"https://cornhub.objectdepot.net/static/icons/dislike.svg":"https://cornhub.objectdepot.net/static/icons/disliked.svg",width:16,height:16,className:"inline ml-1 mr-1",alt:"Dislike"})," ",(0,m.CZ)(n.dislikes+E)]}),(0,a.jsx)("span",{className:"font-bold",children:"•"}),(0,a.jsx)("button",{className:"ml-2 mr-2 font-bold",onClick:function(){return v(f!==n.id?n.id:void 0)},children:"Reply"}),w&&(w.flags&Z.UserFlags.Staff)!=0?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"font-bold",children:"•"}),(n.flags&Z.CommentFlags.Deleted)!=0?(0,a.jsx)("button",{className:"ml-2 text-green-500 font-bold underline",onClick:function(){return function(){return S.apply(this,arguments)}()},children:(0,a.jsx)(P.N,{id:"video.comments.moderation.restore"})}):(0,a.jsx)("button",{className:"ml-2 text-red-500 font-bold underline",onClick:function(){return function(){return C.apply(this,arguments)}()},children:(0,a.jsx)(P.N,{id:"video.comments.moderation.delete"})})]}):null]}):null}),f===n.id?(0,a.jsx)(B,{videoId:n.video_id,refresh:x,replyComment:n}):null]}),(0,a.jsx)("div",{children:n.children.map(function(e){return(0,a.jsx)(J,{comment:e,depth:d+1,refresh:x,commentBoxShownFor:f,setCommentBoxShownFor:v},e.id)})})]})}function B(e){var t=e.videoId,n=e.replyComment,i=void 0===n?null:n,d=e.refresh,m=(0,r._)((0,c.useState)(""),2),v=m[0],x=m[1],g=(0,c.useRef)(null),j=(0,r._)((0,c.useState)(),2),b=j[0],N=j[1],w=(0,u.v9)(function(e){return e.user}),y=(0,p.useRouter)();if(!w)return i&&y.push("/login"),null;function _(){return(_=(0,s._)(function(){var e;return(0,o.Jh)(this,function(n){switch(n.label){case 0:if(v.length<1||v.length>2048||!b)return[2];return x(""),[4,l.ZP.post("/video/".concat(t,"/comment"),{comment:v,reply_to:null!==i?i.id:null,turnstile:b})];case 1:return n.sent(),N(void 0),null===(e=g.current)||void 0===e||e.reset(),d(),[2]}})})).apply(this,arguments)}return(0,a.jsxs)("div",{className:"overflow-auto mt-3",children:[(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("img",{src:(0,h.SX)(w),width:48,height:48,alt:"Avatar",className:"rounded-full h-full"}),(0,a.jsx)("div",{className:"w-full comment-box ml-5 relative",children:(0,a.jsx)("textarea",{className:"rounded-none resize-none text-black w-full p-1 z-10",rows:4,placeholder:"Share what you think",maxLength:2048,onChange:function(e){return x(e.target.value)},value:v})})]}),null===b?(0,a.jsx)("p",{className:"float-left text-red-500",children:(0,a.jsx)(P.N,{id:"turnstile.verification_failed"})}):null,void 0===b?(0,a.jsx)("p",{className:"float-left text-blue-500",children:(0,a.jsx)(P.N,{id:"turnstile.verifying"})}):null,(0,a.jsx)(f.Nc,{siteKey:"0x4AAAAAAABzV2tD73ijh26J",onSuccess:function(e){return N(e)},onError:function(){return N(null)},options:{action:"comment",size:"invisible"},ref:g}),(0,a.jsx)("button",{className:"p-2 bg-gray-800 hover:bg-gray-700 active:bg-gray-600 disabled:bg-gray-500 rounded-sm m-1 float-right transition",disabled:""===v||!b,onClick:function(){return function(){return _.apply(this,arguments)}()},children:(0,a.jsx)(P.N,{id:"video.comments.create"})})]})}function q(e){var t=e.video,n=(0,r._)((0,c.useState)(),2),i=n[0],u=n[1];return((0,c.useEffect)(function(){function e(){return(e=(0,s._)(function(){return(0,o.Jh)(this,function(e){switch(e.label){case 0:return[4,l.ZP.get("/recommendation/sidebar/".concat(t.id))];case 1:return u(e.sent().data),[2]}})})).apply(this,arguments)}!function(){e.apply(this,arguments)}()},[t.id]),i)?i.map(function(e){return(0,a.jsx)(v.Z,{video:e,inList:!0},e.id)}):[0,1,2,3,4].map(function(e){return(0,a.jsxs)("div",{className:"animate-pulse flex",children:[(0,a.jsx)("div",{className:"w-4/7 mt-1 bg-gray-900 thumbnail-aspect-ratio"}),(0,a.jsxs)("div",{className:"w-3/7 ml-1",children:[(0,a.jsx)("div",{className:"mt-2 bg-gray-700 h-1/8"}),(0,a.jsx)("div",{className:"mt-1 bg-gray-700 h-1/8"}),(0,a.jsx)("div",{className:"w-1/2 mt-1 bg-gray-800 h-1/8"})]})]},e)})}function D(e){return null==e}A.getInitialProps=(i=(0,s._)(function(e){var t,n,i,s,r,a,c,u;return(0,o.Jh)(this,function(o){switch(o.label){case 0:return t=e.req,i=void 0===(n=e.res)?{}:n,s=e.query.id,[4,l.ZP.get("/video/".concat(s),{req:t})];case 1:if(a=(r=o.sent()).data,c=r.errored,u=r.status,c){if(404===u)return i.statusCode=404,[2,{error:{status:404,message:"404 - Video Not Found"}}];return i.statusCode=503,[2,{error:{status:503}}]}return[2,{video:a}]}})}),function(e){return i.apply(this,arguments)})},1569:function(e,t,n){"use strict";n.d(t,{AJ:function(){return r},WX:function(){return o}});var i=n(11762),s=["360","480","720","1080","2160"];function r(e){var t="https://cornhub.objectdepot.net/static/no_thumbnail.jpg";return(e.thumbnails&i.ThumbnailFlags.HQ)!=0?t="https://cornhub.objectdepot.net/thumbnail/".concat(e.link_id,"/hq.jpg"):(e.thumbnails&i.ThumbnailFlags.LQ)!=0&&(t="https://cornhub.objectdepot.net/thumbnail/".concat(e.link_id,"/lq.jpg")),t}function o(e){var t=[];for(var n in s)(e.qualities&1<<n)!=0&&t.push(s[n]);return t}},7108:function(e){function t(e){let t=new Date(e.created_at),n=Math.round((Date.now()-t.getTime())/36e5),{likes:i,dislikes:s}=e,r=1/(n/24);return 5*r+(i-s)-(s>0?s*r*3.5:0)}e.exports={sortComments:function(e,n){return t(n)-t(e)},commentScore:t}}},function(e){e.O(0,[187,36,774,888,179],function(){return e(e.s=44614)}),_N_E=e.O()}]);
//# sourceMappingURL=[id]-1873da6eb601b0f7.js.map